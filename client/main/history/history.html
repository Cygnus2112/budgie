<body>
  <div id="page-content-wrapper">
    <div class="container">
      <h1>Transaction History</h1>
        <div class="form-group">
          <div class="col-lg-12">
            <label for="select" class="col-lg-2 control-label">Selects</label>
              <div class="col-lg-10">
                  <select class="form-control" id="select" ng-model="history.inputType">
                    <option value="">income and expenses</option>
                    <option value="income">income</option>
                    <option value="expense">expenses</option>
                  </select>
              </div>
          </div>
        </div>

        <div class="form-group">
          <div class="col-lg-12">
            <label for="select" class="col-lg-2 control-label">Show transactions for: </label>
              <div class="col-lg-10">
                  <select class="form-control" id="select" ng-model="history.dates" ng-change="history.filterDates(history.dates)">
                    <option value="7">past 7 days</option>
                    <option value="30">past 30 days</option>
                    <option value="180">past 6 months</option>
                  </select>
              </div>
          </div>
        </div>

    <!-- DROPBOX/CSV EXPORT -->
      <button class="btn btn-default" ng-csv-dropbox="history.allTable" csv-header="['Amount','Name','Category','Notes','Type']"
      csv-column-order="['amount','name','category','notes','inputType']" filename="BudgieHistory.csv" field-separator="," decimal-separator=".">
      Export to Dropbox</button>

      <button class="btn btn-default" ng-csv="history.allTable" csv-header="['Amount','Name','Category','Notes','Type']"
      csv-column-order="['amount','name','category','notes','inputType']" filename="BudgieHistory.csv" field-separator="," decimal-separator=".">
      Export to CSV</button>

      <table class="table table-hover">
        <thead>
          <tr>
            <th ng-click="history.sortBy('amount')">Amount</th><span class="sortorder" ng-class="{reverse:reverse}"></span>
            <th ng-click="history.sortBy('name')">Expense</th><span class="sortorder" ng-class="{reverse:reverse}"></span>
            <th ng-click="history.sortBy('category')">Category</th><span class="sortorder" ng-class="{reverse:reverse}"></span>
            <th ng-click="history.sortBy('spent_date')">Time</th><span class="sortorder" ng-class="{reverse:reverse}"/>
            <th ng-click="history.sortBy('location')">Location</th><span class="sortorder" ng-class="{reverse:reverse}"/>
            <th ng-click="history.sortBy('notes')">Notes</th><span class="sortorder" ng-class="{reverse:reverse}"/>
          </tr>
        </thead> 
  
        <tbody>

        <tr ng-class="{success: expenseThings.inputType === 'expense', info: expenseThings.inputType === 'income'}" ng-repeat="expenseThings in history.allTable | filter: history.inputType | orderBy:cat:reverse">
            <td>{{expenseThings.amount}}</td>
            <td>{{expenseThings.name}}</td>
            <td>{{expenseThings.category}}</td>
            <td>{{expenseThings.spent_date}}</td>
            <td style="overflow: hidden;white-space: nowrap; height: 60px; max-width: 175px; text-overflow: ellipsis;" title="{{expenseThings.location}}">{{expenseThings.location}}</td>
            <td>{{expenseThings.notes}}</td>
             <td>
                <a ng-click="history.editClick($index, expenseThings.id)" data-toggle="modal" data-target="#editModal" class="btn btn-info btn-sm">edit</a>
            </td>
            <td class="text-right">
              <button type="button" value="Remove" data-ng-click="history.removeRow($index, expenseThings.id, expenseThings.inputType)" class="button-remove icon ion-close-round" aria-label="Remove"></button>
		        </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

<!--  EDIT TRANSACTION MODAL -->

<div class="modal fade" id="editModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" ></button>
          <h4 class="modal-title" id="editModalLabel">Edit Transaction</h4>
        </div>
        <div class="modal-body">
          <form name="formEditTransaction" class="form-horizontal expense-form text-center" novalidate>
            <fieldset>
              <div class="form-group" ng-class="{'has-error': formEditTransaction.newAmount.$error.required}">
                <label for="inputNewAmount" class="sr-only">Amount</label>
                <input type="number" class="form-control" id="new-amount" placeholder="Amount" name="newAmount" ng-model="history.newAmount" required>
              </div>
              <div class="form-group" ng-class="{'has-error': formEditTransaction.newExpenseItem.$error.required}">
                <input type="text" class="form-control" id="new-expense-item" placeholder="Expense" name="newExpenseItem" ng-model="history.newExpenseItem" required>
              </div>
              <div class="form-group" ng-class="{'has-error': formEditTransaction.newSpentDate.$error.required}">
                <input type="time" class="form-control" id="new-time" name="newTime" name="newSpentDate" ng-model="history.newSpentDate" required>
              </div>
              <div class="form-group">
                <label for="select" class="sr-only">Category:</label>
                <select id="new-category" class="form-control select" name="newCategory" ng-model="history.newCategory">
                  <option value="Food & Drink">Food & Drink</option>
                  <option value="Entertainment">Entertainment</option>
                  <option value="Education">Education</option>
                  <option value="Travel">Travel</option>
                  <option value="Rent">Rent</option>
                  <option value="Household">Household</option>
                  <option value="Transport">Transport</option>
                  <option value="Payments">Payments</option>
                  <option value="Shopping">Shopping</option>
                  <option value="Healthcare">Healthcare</option>
                  <option value="Tax">Tax</option>
                  <option value="Miscellaneous">Miscellaneous</option>
                </select>
              </div>
              <div class="form-group">
                <input type="text" class="form-control" id="new-notes" placeholder="Notes" name="newNotes" ng-model="history.newNotes"/>
              </div>
              <div class="form-group">
                <input type="text" class="form-control" id="newlocation" placeholder="Location" name="newLocation" ng-model="history.newLocation">
              </div>
            </fieldset>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" ng-disabled="formEditTransaction.$invalid" ng-click="history.editRow(history.newIndex, history.newId, history.inputType)" data-dismiss="modal" >Save</button>
        </div>
      </div>
    </div>
  </div>

<!--  TRANSACTION MAP VIEW -->

      <div>
        <h2>Hover over a marker to view transaction details</h2>
        <section class="map-container">
          <div id="map_canvas" ></div>
        </section>
      </div>


    </div>
  </div>
</body>
